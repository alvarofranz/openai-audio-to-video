<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Storytelling Dashboard</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='assets/img/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/styles.css') }}">
    <script src="{{ url_for('static', filename='assets/js/general.js') }}" defer></script>
</head>
<body>
<header>
    <h1>üó£Ô∏è Speak your words into a living slideshow  üé•</h1>
</header>

<main id="main-content">
    <!-- Step 0: Settings form -->
    <form id="settings-form" class="settings-form">
        <div class="form-row">
            <label for="words-per-scene">Words per scene:</label>
            <input
                    type="number"
                    id="words-per-scene"
                    value="{{ default_words_per_scene }}"
                    class="small-input"
            >
        </div>

        <div class="form-row">
            <label for="text-model">Text model:</label>
            <input
                    type="text"
                    id="text-model"
                    value="{{ default_text_model }}"
                    class="medium-input"
            >
        </div>

        <div class="form-row">
            <label for="size-select">Size:</label>
            <select id="size-select">
                <option
                        value="1024x1024"
                        {% if default_video_size == "1024x1024" %}selected{% endif %}
                >1024x1024</option>
                <option
                        value="1792x1024"
                        {% if default_video_size == "1792x1024" %}selected{% endif %}
                >1792x1024</option>
                <option
                        value="1024x1792"
                        {% if default_video_size == "1024x1792" %}selected{% endif %}
                >1024x1792</option>
            </select>
        </div>

        <div class="form-row">
            <label for="image-prompt-style">IMAGE_PROMPT_STYLE:</label><br>
            <textarea id="image-prompt-style" rows="4" class="full-width-textarea">{{ default_image_prompt_style }}</textarea>
        </div>

        <div class="form-row">
            <label for="characters-prompt-style">CHARACTERS_PROMPT_STYLE:</label><br>
            <textarea id="characters-prompt-style" rows="4" class="full-width-textarea">{{ default_characters_prompt_style }}</textarea>
        </div>

        <div class="form-row">
            <label for="image-preprocessing-prompt">IMAGE_PREPROCESSING_PROMPT:</label><br>
            <textarea id="image-preprocessing-prompt" rows="6" class="full-width-textarea">{{ default_image_preprocessing_prompt }}</textarea>
        </div>
    </form>

    <!-- Step 1: Audio upload -->
    <div id="upload-section" class="upload-section">
        <input type="file" id="audio-file-input" accept="audio/*" />
        <button id="upload-btn" type="button">Use this audio</button>
    </div>

    <!-- Step 1.5: Show "Uploading audio..." with a Cancel button while the request is in flight -->
    <div id="uploading-section" class="uploading-section" style="display:none;">
        <p id="uploading-feedback" class="loading-feedback">
            Uploading audio...
        </p>
        <button id="upload-cancel-btn" class="red-button">Cancel</button>
    </div>

    <!-- Step 2: After audio is fully uploaded & transcribed, show embedded audio + summary -->
    <div id="audio-processing-section" style="display:none;">
        <audio controls id="uploaded-audio" class="uploaded-audio"></audio>
        <div id="whisper-loading" class="loading-feedback" style="display:none;">
            Converting audio to text...
        </div>
        <p id="story-description" class="story-description" style="display:none;"></p>
        <p id="story-ingredients" class="story-ingredients" style="display:none; white-space:pre-wrap;"></p>
    </div>

    <!-- Step 3.5: chunk processing status -->
    <div id="chunk-processing-status" class="loading-feedback" style="display:none;">
        Processing chunks...
    </div>

    <!-- Scenes container -->
    <div id="scenes-container"></div>

    <!-- Generate video button & indefinite loading -->
    <div id="video-generation-section" style="display:none;">
        <button id="generate-video-btn" disabled>Generate Video</button>
        <div id="video-progress" class="loading-feedback" style="display:none;">
            Generating video...
        </div>
    </div>

    <!-- Final video embed, center it, show the path -->
    <div id="final-video-section" style="display:none;">
        <video controls id="final-video">
            <source id="final-video-source" src="" type="video/mp4">
        </video>
        <div id="final-video-path"></div>
    </div>

</main>
</body>
</html>
